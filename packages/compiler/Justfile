set quiet

test: gen
    bun test

build: _install_deps gen

gen:
    bunx langium generate
    just _merge_textmate_syntax_files


_install_deps:
    bun install

# highlighting instructions into the generate tao-lang.tmLanguage.json file.
_merge_textmate_syntax_files:
    npx node-jq \
        -s '.[0].repository += .[1].repository | .[0].patterns += .[1].patterns | .[0]' \
        ./symlink-ide-syntaxes/_gen-syntaxes/tao-lang.tmLanguage.json ./symlink-ide-syntaxes/tao-lang.ts-code-blocks-merge.tmLanguage.json \
        | npx sponge ./symlink-ide-syntaxes/_gen-syntaxes/tao-lang.tmLanguage.json
