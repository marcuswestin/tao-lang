set fallback := true
set quiet := true

_pretest:
    just gen

build:
    bun install
    just gen

gen:
    bunx langium generate --mode=development
    just _merge_textmate_syntax_files

watch-compiler:
    bun -e "import 'compiler-src/compiler-main'; console.log('Reload...'); " --watch --no-clear-screen

watch-grammar:
    watchexec --restart --watch=tao-grammar.langium -- just gen

# highlighting instructions into the generate tao-lang.tmLanguage.json file.
_merge_textmate_syntax_files:
    npx node-jq \
        -s '.[0].repository += .[1].repository | .[0].patterns += .[1].patterns | .[0]' \
        ./symlink-ide-syntaxes/_gen-syntaxes/tao-lang.tmLanguage.json ./symlink-ide-syntaxes/tao-lang.ts-code-blocks-merge.tmLanguage.json \
        | npx sponge ./symlink-ide-syntaxes/_gen-syntaxes/tao-lang.tmLanguage.json
