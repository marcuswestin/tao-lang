set unstable := true
set fallback := true
# set quiet := true

build:
    just _install_deps

run: _install_deps
    bunx expo start --web --ios

JEST_ARGS := "--detectOpenHandles"
JEST_WATCH_ARGS := JEST_ARGS + " --watch --silent --reporter=dot  --watchPathIgnorePatterns='.'"

[no-quiet]
test *FLAGS_AND_PATTERNS:
    # Hermes (expo runner) requires import.meta.url to be defined.
    # It's a hack, and I'd like to make it cleaner.
    just tao-cli build-lib {{ justfile_directory() }}/_gen-tao-lib
    bunx jest {{ JEST_ARGS }} -t {{ FLAGS_AND_PATTERNS }}


watch-tests *FLAGS_AND_PATTERNS:
    bunx jest {{ JEST_WATCH_ARGS }} -t {{ FLAGS_AND_PATTERNS }}

_install_deps:
    bun install
